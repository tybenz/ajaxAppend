<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>AjaxAppend by TylerBenziger</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <link rel="stylesheet" href="stylesheets/ajax.append.css">
    <script src="http://code.jquery.com/jquery.min.js"></script>
    <script src="https://raw.github.com/TylerBenziger/ajaxAppend/master/ajax.append.js"></script>
    <script src="javascripts/scale.fix.js"></script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
    <script type="text/javascript">
        $(function() {
            _.templateSettings = {
        	 	evaluate: /\{\%(.+?)\%\}/g,
        		interpolate: /\{\{(.+?)\}\}/g
        	};

            $( '#rf1' ).ajaxAppend({
                dataName: 'stories',
                templates: [{
                    template: $( "#story-template" ).text(),
                    selector: '#whats-new-feed',
                    order: 'prepend',
                    callback: function() {
                        var val = parseInt( $( "#rf1 [name=num]" ).val() );
                        $( "#rf1 [name=num]" ).val( val + 1 );
                    },
                }],
                formReset: false
            });
        });
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">AjaxAppend</h1>
        <p class="header">a jQuery Plugin to help automatic template creation on ajax callbacks</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/TylerBenziger/ajaxAppend/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/TylerBenziger/ajaxAppend/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/TylerBenziger/ajaxAppend">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/TylerBenziger">TylerBenziger</a></p>


      </header>
      <section>
        <h1>Welcome</h1>

        <p>AjaxAppend is a jQuery Plugin designed to work with Rail's UJS remote forms.
        It makes it easier to automatically inject populated templates into your page based on a JSON AJAX response.</p>

        <h3>Example</h3>

        <p>This is an example of a form that is meant to grab a block of "posts" and inject them into a feed div</p>

        <script type="text/javascript">
            $( '#rf1' ).ajaxAppend({
                dataName: 'stories',
                templates: [{
                    template: $( "#story-template" ).text(),
                    selector: '#whats-new-feed',
                    order: 'prepend'
                }],
                formReset: false
            });
        </script>

        <!-- Template for our news story -->
        <script type="underscore-template" id="story-template">
            {% _.each(stories, function( post ) { %}
                <div class="post">
                    <h4 class="nt">{{post.headline}}<span class="date s">{{post.date}}</span></h4>
                    <p>
                        {{post.story}}
                    </p>
                </div>
            {% }); %}
        </script>

        <div id="whats-new">
            <form id="rf1" data-remote="true" action="get.html" method="post" style="">
                <input type="hidden" name="num" value="0" />

                <input type="submit" value="Get More News" />
            </form>
            <!-- This is where the templates will be injected -->
            <div id="whats-new-feed">
                <div class="post">
                    <h4 class="nt">First Post<span class="date s">01/03/2011</span></h4>
                    <p>
                        Click the link above to get more stories
                    </p>
                </div>
            </div>
            <br class="clear" />
        </div>

<h3>Source</h3>

<div class="highlight">
<pre><span class="c">&lt;!-- Initializing the ajaxAppend plugin --&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
    <span class="nx">$</span><span class="p">(</span> <span class="s1">'#rf1'</span> <span class="p">).</span><span class="nx">ajaxAppend</span><span class="p">({</span>
        <span class="nx">dataName</span><span class="o">:</span> <span class="s1">'stories'</span><span class="p">,</span>
        <span class="nx">templates</span><span class="o">:</span> <span class="p">[{</span>
            <span class="nx">template</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span> <span class="s2">"#story-template"</span> <span class="p">).</span><span class="nx">text</span><span class="p">(),</span>
            <span class="nx">selector</span><span class="o">:</span> <span class="s1">'#whats-new-feed'</span><span class="p">,</span>
            <span class="nx">order</span><span class="o">:</span> <span class="s1">'prepend'</span>
        <span class="p">}],</span>
        <span class="nx">formReset</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>

<span class="c">&lt;!-- Template for our news story --&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"underscore-template"</span> <span class="na">id=</span><span class="s">"story-template"</span><span class="nt">&gt;</span>
    <span class="p">{</span><span class="o">%</span> <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">stories</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">post</span> <span class="p">)</span> <span class="p">{</span> <span class="o">%</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">"post"</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">h4</span><span class="o">&gt;</span><span class="p">{{</span><span class="nx">post</span><span class="p">.</span><span class="nx">headline</span><span class="p">}}</span><span class="o">&lt;</span><span class="nx">span</span> <span class="kr">class</span><span class="o">=</span><span class="s2">"date"</span><span class="o">&gt;</span><span class="p">{{</span><span class="nx">post</span><span class="p">.</span><span class="nx">date</span><span class="p">}}</span><span class="o">&lt;</span><span class="err">/span&gt;&lt;/h4&gt;</span>
            <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
                <span class="p">{{</span><span class="nx">post</span><span class="p">.</span><span class="nx">story</span><span class="p">}}</span>
            <span class="o">&lt;</span><span class="err">/p&gt;</span>
        <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">{</span><span class="o">%</span> <span class="p">});</span> <span class="o">%</span><span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"whats-new"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3&gt;</span>News Example<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"rf1"</span> <span class="na">data-remote=</span><span class="s">"true"</span> <span class="na">action=</span><span class="s">"get.php"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">style=</span><span class="s">""</span><span class="nt">&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"num"</span> <span class="na">value=</span><span class="s">"0"</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Get More News"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    <span class="c">&lt;!-- This is where the templates will be injected --&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"whats-new-feed"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;br</span> <span class="na">class=</span><span class="s">"clear"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre>
</div>

      </section>
      <footer>
        <p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
		
  </body>
  <script type="text/javascript">
          // Faking Rail's ajax:success method, ensuring responseText is put in the right place
    $(function() {
        $( "[data-remote=true]" ).submit( function( evt ) {
            evt.preventDefault();
            var $this = $( this ),
                data = $this.serialize(),
                num = $this.find( '[name=num]' ).val();

            $.ajax({
                type: $this.attr( 'method' ),
                url: $this.attr( 'action' ),
                data: data,
                dataType: 'text',
                success: function( response ) {
                    $this.trigger( 'ajax:success', [ null, null, { responseText: JSON.stringify( JSON.parse( response )[ num % 3] ) } ] );
                }
            });
        });
    });
  </script>
</html>